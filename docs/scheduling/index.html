<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Ethan Hann">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Scheduling - InEngine.NET</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/style.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">InEngine.NET</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Getting Started</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../commands/">Commands</a>
</li>
                            
<li class="active">
    <a href="./">Scheduling</a>
</li>
                            
<li >
    <a href="../queuing/">Queuing</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../commands/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../queuing/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/InEngine-NET/InEngine.NET">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#scheduling">Scheduling</a></li>
            <li><a href="#scheduling-a-command">Scheduling a Command</a></li>
            <li><a href="#running-the-scheduler">Running the Scheduler</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="scheduling">Scheduling</h1>
<p><a href="../commands">Commands</a> can be scheduled to run by leveraging the InEngineScheduler.exe program, available as a download from a recent <a href="https://github.com/InEngine-NET/InEngine.NET/releases">release</a>.</p>
<h2 id="scheduling-a-command">Scheduling a Command</h2>
<p>A job schedule is created by adding a class to your plugin assembly that implements the <strong>InEngine.Core.Jobs</strong> interface.</p>
<pre><code class="csharp">
using System;
using Quartz;

namespace MyCommandPlugin
{
    public class Jobs : IJobs
    {
        public void Schedule(IScheduler scheduler)
        {
            // Schedule some jobs
        }
    }
}
</code></pre>

<p>This class is automatically discovered by the InEngine.NET scheduler.
It will call the Jobs.Schedule method with an initialized Quartz.NET scheduler object.</p>
<pre><code class="csharp">using System;
using Quartz;

namespace MyCommandPlugin
{
    public class Jobs : IJobs
    {
        public void Schedule(IScheduler scheduler)
        {
            var myCommand = new MyCommand();

            // Generate a schedulable job with the command
            var job = myCommand.MakeTriggerBuilder().Build();

            // Generate a trigger for the job, and set its schedule to every 10 seconds.
            var trigger = myCommand.MakeTriggerBuilder().Build()
                .StartNow()
                .WithSimpleSchedule(x =&gt; x.WithIntervalInSeconds(10).RepeatForever())
                .Build();

            // Register the job and trigger with the scheduler
            scheduler.ScheduleJob(job, trigger);
        }
    }
}

</code></pre>

<h2 id="running-the-scheduler">Running the Scheduler</h2>
<h3 id="manually-from-the-cli">Manually from the CLI</h3>
<p>Running the scheduler from the CommandLine is useful for debugging or local development. Simply run <em>InEngineScheduler.exe</em> from the command line.</p>
<pre><code class="bash">InEngineScheduler.exe
</code></pre>

<p>It can also be run on Mac/Linux with Mono.</p>
<pre><code class="bash">mono InEngineScheduler.exe
</code></pre>

<h3 id="on-windows-as-a-service">On Windows as a Service</h3>
<h4 id="installing">Installing</h4>
<p>Run the Install.ps1 PowerShell script in the scheduler directory to install the scheduler in place. The script needs to be run as an administrator. The script will register the service at the location where the script is run. </p>
<pre><code class="bash">ps Install.ps1
</code></pre>

<h4 id="uninstalling">Uninstalling</h4>
<p>Simply run the <strong>Uninstall.ps1</strong> script with elevated permissions to unregister the service.</p>
<pre><code class="bash">ps Uninstall.ps1
</code></pre>

<h3 id="on-linux-with-supervisor">On Linux with Supervisor</h3>
<p>Supervisor is a process control system for Linux. It has extensive <a href="http://supervisord.org/index.html">documentation</a>, but the following should be enough to get started.</p>
<h4 id="installing-supervisor">Installing Supervisor</h4>
<p>This command installs Supervisor on Ubuntu:</p>
<pre><code>sudo apt-get install supervisor
</code></pre>

<h4 id="configuring-supervisor">Configuring Supervisor</h4>
<p>Supervisor configuration files are stored in the <strong>/etc/supervisor/conf.d</strong> directory. Multiple files can be created in this directory to specify different programs, or multiple instances of the same program, for Supervisor to monitor. Copy this sample config into a file called <strong>/etc/supervisor/conf.d/inengine-scheduler.conf</strong>. </p>
<pre><code class="ini">[program:inengine-scheudler]
process_name=%(program_name)s_%(process_num)02d
directory=/path/to/scheduler
command=mono InEngineScheduler.exe
autostart=true
autorestart=true
user=InEngine
numprocs=1
redirect_stderr=true
stdout_logfile=./scheduler.log
</code></pre>

<h4 id="starting-supervisor">Starting Supervisor</h4>
<p>Whenever a configuration change happens to files in the Supervisor config files, Supervisor needs to be instructed to reload its configuration.</p>
<pre><code class="bash">sudo supervisorctl reread
sudo supervisorctl update
</code></pre>

<p>Now, simply start the InEngine Scheduler.</p>
<pre><code class="bash">sudo supervisorctl start inengine-scheduler:*
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Â© 2017 - Ethan Hann</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
